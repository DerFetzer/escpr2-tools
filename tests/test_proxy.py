from escpr2_tools.constants import EPS_MSID_A4
from escpr2_tools.escpr_commands import EscprCommandJSetj, EscprCommandPSetq
from escpr2_tools.proxy import get_paper_size_id


def test_get_paper_size_id():
    buf = bytes(
        [
            0x00,
            0x05,
            0x00,
            0x1B,
            0x00,
            0x00,
            0x00,
            0x1B,
            0x28,
            0x52,
            0x06,
            0x00,
            0x00,
            0x45,
            0x53,
            0x43,
            0x50,
            0x52,
            0x1B,
            0x71,
            0x09,
            0x00,
            0x00,
            0x00,
            0x73,
            0x65,
            0x74,
            0x71,
            0x0C,
            0x02,
            0x00,
            0x00,
            0x00,
            0x00,
            0x03,
            0x00,
            0x00,
            0x1B,
            0x71,
            0x0A,
            0x00,
            0x00,
            0x00,
            0x73,
            0x65,
            0x74,
            0x69,
            0x01,
            0x01,
            0x00,
            0x00,
            0x00,
            0x00,
            0x00,
            0x00,
            0x00,
            0x00,
            0x1B,
            0x6A,
            0x16,
            0x00,
            0x00,
            0x00,
            0x73,
            0x65,
            0x74,
            0x6A,
            0x00,
            0x00,
            0x0B,
            0xA0,
            0x00,
            0x00,
            0x10,
            0x71,
            0x00,
            0x2A,
            0x00,
            0x2A,
            0x00,
            0x00,
            0x0B,
            0x4C,
            0x00,
            0x00,
            0x10,
            0x1D,
            0x00,
            0x00,
            0x1B,
            0x70,
            0x00,
            0x00,
            0x00,
            0x00,
            0x73,
            0x74,
            0x74,
            0x70,
            0x1B,
            0x70,
            0x0C,
            0x00,
            0x00,
            0x00,
            0x73,
            0x65,
            0x74,
            0x71,
            0x00,
            0x03,
            0x04,
            0x00,
            0xDC,
            0x00,
            0x00,
            0x00,
            0x00,
            0x00,
            0x00,
            0x00,
        ]
    )
    assert get_paper_size_id(buf) == EPS_MSID_A4


def test_j_setj_header():
    j_setj_header = bytes(
        [
            0x1B,
            0x6A,
            0x16,
            0x00,
            0x00,
            0x00,
            0x73,
            0x65,
            0x74,
            0x6A,
        ]
    )
    assert j_setj_header == EscprCommandJSetj.get_esc_command_header()


def test_p_setq():
    b = bytes(
        [
            0x1B,
            0x70,
            0x0C,
            0x00,
            0x00,
            0x00,
            0x73,
            0x65,
            0x74,
            0x71,
            0x00,
            0x03,
            0x04,
            0x00,
            0xDC,
            0x00,
            0x00,
            0x00,
            0x00,
            0x00,
            0x00,
            0x00,
        ]
    )
    p_setq = EscprCommandPSetq()
    p_setq.ColorPlane = 0x03
    p_setq.LUT = 0x04
    p_setq.GammaCorrect = 0xDC

    assert p_setq.__bytes__() == b
